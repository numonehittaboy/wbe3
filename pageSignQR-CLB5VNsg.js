const __vite__fileDeps=["./pageSignIn-DG8Ri5A9.js","./index-j81mEYxC.js","./index-DXYgLilc.css","./putPreloader-DzTMXMC2.js","./page-CD8Li8HN.js","./inputField-DFBRs3wP.js","./countryInputField-BU_S261q.js","./textToSvgURL-Cnw_Q8Rw.js","./qr-code-styling-CvBVNv73.js","./_commonjsHelpers-Cpj98o6Y.js","./pageIm-BYAFySl2.js","./pagePassword-CtXLALRH.js","./htmlToSpan-CO8NsJDs.js","./loginPage-B60WJ3ba.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{k as d,B as A,o as V,b as l,c as $,h as F,g as z,d as H,i as N,_ as E,n as j,A as C,p as b}from"./index-j81mEYxC.js";import{P as W}from"./page-CD8Li8HN.js";import{p as O}from"./putPreloader-DzTMXMC2.js";import{b as G,t as J}from"./textToSvgURL-Cnw_Q8Rw.js";let T=!1;function K(){return P||(P=l.managers.apiManager.getConfig().then(e=>e.suggested_lang_code!==d.lastRequestedLangCode?Promise.all([e,d.getStrings(e.suggested_lang_code,["Login.ContinueOnLanguage"]),d.getCacheLangPack()]):[]))}let P;function U(e){T||K().then(([t,u])=>{if(!t)return;const s=[];u.forEach(i=>{const m=d.strings.get(i.key);m&&(s.push(m),d.strings.set(i.key,i))});const o="Login.ContinueOnLanguage",a=A("btn-primary btn-secondary btn-primary-transparent primary",{text:o});a.lastElementChild.classList.remove("i18n"),V({text:[d.format(o,!0)]}).then(()=>{window.requestAnimationFrame(()=>{e.append(a)})}),l.addEventListener("language_change",()=>{a.remove()},{once:!0}),s.forEach(i=>{d.strings.set(i.key,i)}),$(a,i=>{F(i),T=!0,a.disabled=!0,O(a),d.getLangPack(t.suggested_lang_code)})})}function X(e,t){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")}function Y(e){let t,u="";for(let s=e.length,o=0,a=0;a<s;++a)t=a%3,o|=e[a]<<(16>>>t&24),(t===2||s-a===1)&&(u+=String.fromCharCode(L(o>>>18&63),L(o>>>12&63),L(o>>>6&63),L(o&63)),o=0);return u.replace(/A(?=A$|$)/g,"=")}function L(e){return e<26?e+65:e<52?e+71:e<62?e-4:e===62?43:e===63?47:65}const R=3,Z=async()=>{const t=x.pageEl.querySelector(".auth-image");let u=O(t,!0);const s=document.createElement("div");s.classList.add("input-wrapper");const o=A("btn-primary btn-secondary btn-primary-transparent primary",{text:"Login.QR.Cancel"});s.append(o),z()===1&&U(s);const a=t.parentElement,i=document.createElement("h4");H(i,"Login.QR.Title");const m=document.createElement("ol");m.classList.add("qr-description"),["Login.QR.Help1","Login.QR.Help2","Login.QR.Help3"].forEach(c=>{const p=document.createElement("li");p.append(N(c)),m.append(p)}),a.append(i,m,s),o.addEventListener("click",()=>{E(()=>import("./pageSignIn-DG8Ri5A9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url).then(c=>c.default.mount()),h=!0});const I=(await Promise.all([E(()=>import("./qr-code-styling-CvBVNv73.js").then(c=>c.q),__vite__mapDeps([8,9]),import.meta.url)]))[0].default;let h=!1;l.addEventListener("user_auth",c=>{h=!0,_=null},{once:!0});const k={ignoreErrors:!0};let w;const q=async c=>{try{const p=await j.getUserIds();let n=await l.managers.apiManager.invokeApi("auth.exportLoginToken",{api_id:C.id,api_hash:C.hash,except_ids:p.map(g=>g.toUserId())},{ignoreErrors:!0});if(n._==="auth.loginTokenMigrateTo"&&(k.dcId||(k.dcId=n.dc_id,l.managers.apiManager.setBaseDcId(n.dc_id)),n=await l.managers.apiManager.invokeApi("auth.importLoginToken",{token:n.token},k)),n._==="auth.loginTokenSuccess"){const g=n.authorization;return await l.managers.apiManager.setUser(g.user),E(()=>import("./pageIm-BYAFySl2.js"),__vite__mapDeps([10,1,2,4]),import.meta.url).then(f=>f.default.mount()),!0}if(!w||!G(w,n.token)){w=n.token;const g=Y(n.token),f="tg://login?token="+X(g,!0),v=window.getComputedStyle(document.documentElement),B=v.getPropertyValue("--surface-color").trim(),D=v.getPropertyValue("--primary-text-color").trim(),M=v.getPropertyValue("--primary-color").trim(),Q=await fetch("assets/img/logo_padded.svg").then(r=>r.text()).then(r=>(r=r.replace(/(fill:).+?(;)/,`$1${M}$2`),J(r))),y=new I({width:240*window.devicePixelRatio,height:240*window.devicePixelRatio,data:f,image:Q,dotsOptions:{color:D,type:"rounded"},cornersSquareOptions:{type:"extra-rounded"},imageOptions:{imageSize:1,margin:0},backgroundOptions:{color:B},qrOptions:{errorCorrectionLevel:"L"}});y.append(t),t.lastChild.classList.add("qr-canvas");let S;y._drawingPromise?S=y._drawingPromise:S=Promise.race([b(1e3),new Promise(r=>{y._canvas._image.addEventListener("load",()=>{window.requestAnimationFrame(()=>r())},{once:!0})})]),await S.then(()=>{if(u){u.style.animation="hide-icon .4s forwards";const r=t.children[1];r.style.display="none",r.style.animation="grow-icon .4s forwards",setTimeout(()=>{r.style.display=""},150),setTimeout(()=>{r.style.animation=""},500),u=void 0}else Array.from(t.children).slice(0,-1).forEach(r=>{r.remove()})})}if(c){const g=Date.now()/1e3,f=n.expires-g-await l.managers.timeManager.getServerTimeOffset();await b(f>R?1e3*R:1e3*f|0)}}catch(p){switch(p.type){case"SESSION_PASSWORD_NEEDED":E(()=>import("./pagePassword-CtXLALRH.js"),__vite__mapDeps([11,1,2,3,4,12,5,13]),import.meta.url).then(n=>n.default.mount()),h=!0,_=null;break;default:console.error("pageSignQR: default error:",p),h=!0;break}return!0}return!1};return async()=>{h=!1;do if(h||await q(!0))break;while(!0)}};let _;const x=new W("page-signQR",!0,()=>_,()=>{_||(_=Z()),_.then(e=>{e()}),l.managers.appStateManager.pushToState("authState",{_:"authStateSignQr"})}),oe=Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"}));export{oe as a,U as g,x as p};
//# sourceMappingURL=pageSignQR-CLB5VNsg.js.map
