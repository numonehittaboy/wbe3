import{e as ee,eu as te,H as w,ev as E,M as G,bb as se,bg as ne,b7 as ie,d6 as oe,ew as ae,ex as le,ey as j,Y as F,b as V,al as re,d as ce,ag as fe,i as D,ar as $,a as de,T as he,$ as q,ez as ue,eA as me,h as ge,cm as pe}from"./index-j81mEYxC.js";import{w as x}from"./page-CD8Li8HN.js";function Q(i,e=!1,t=!0){if(!(ee&&(!e||document.activeElement.tagName!=="INPUT"&&!document.activeElement.isContentEditable)))if(t&&i.focus(),i instanceof HTMLInputElement){const s=i.value.length;i.selectionStart=s,i.selectionEnd=s}else{const s=document.createRange();s.selectNodeContents(i),s.collapse(!1);const n=window.getSelection();n.removeAllRanges(),n.addRange(s)}}window.placeCaretAtEnd=Q;function Ee(i){return Array.from(i.childNodes).map(e=>e.nodeType===e.TEXT_NODE?te(e.textContent):e.outerHTML).join("")}function ye(i,e){return i.closest(`[${e}]`)}function Ne(i,e){return i.closest(e)}function K(i,e){const t=document.getSelection(),s=t.focusNode,n=t.focusOffset;return!w(s,i)&&s!==i?{selection:t}:{...Ce(i,s,n),selection:t}}function Ce(i,e,t){if(e===i){const s=i.childNodes,n=s.length;n&&t>=n?(e=s[n-1],t=(e.textContent||e.alt||"").length):(e=s[t],t=0)}return{node:e,offset:t}}const be=new Set(["messageEntityBold","messageEntityItalic","messageEntityCode","messageEntityPre","messageEntityUnderline","messageEntityStrike","messageEntityBlockquote","messageEntitySpoiler"]);function Se(i){for(let e=0;e<i.length;++e){const t=i[e];let s=-1;do if(s=i.findIndex((n,a)=>be.has(n._)&&a!==e&&n._===t._&&n.offset-t.length===t.offset),s!==-1){const n=i[s];t.length+=n.length,i.splice(s,1)}while(s!==-1)}}function z(i){i.sort((e,t)=>e.offset-t.offset||t.length-e.length)}const O={bold:{match:'[style*="bold"], [style*="font-weight: 700"], [style*="font-weight: 600"], [style*="font-weight:700"], [style*="font-weight:600"], b, strong',entityName:"messageEntityBold"},underline:{match:'[style*="underline"], u, ins',entityName:"messageEntityUnderline"},italic:{match:'[style*="italic"], i, em',entityName:"messageEntityItalic"},monospace:{match:'[style*="monospace"], [face*="monospace"], pre',entityName:"messageEntityCode"},strikethrough:{match:'[style*="line-through"], [style*="strikethrough"], strike, del, s',entityName:"messageEntityStrike"},link:{match:"A:not(.follow)",entityName:"messageEntityTextUrl"},mentionName:{match:"A.follow",entityName:"messageEntityMentionName"},spoiler:{match:'[style*="spoiler"]',entityName:"messageEntitySpoiler"},quote:{match:'[style*="quote"], .quote',entityName:"messageEntityBlockquote"}},ve='[style*="table-cell"], th, td',Te=new Set(["DIV","P","BR","LI","SECTION","H6","H5","H4","H3","H2","H1","TR","OL","UL","BLOCKQUOTE"]),xe=new RegExp(E,"g"),v="";function U(i,e,t,s){const n=i.parentElement;for(const a in O){const o=O[a],l=n.closest(o.match+', [contenteditable="true"]');if(l?.getAttribute("contenteditable")!==null)continue;let d;o.entityName==="messageEntityCode"&&(d=n.closest("[data-language]"))?t.push({_:"messageEntityPre",language:d.dataset.language||"",offset:s.offset,length:e.length}):o.entityName==="messageEntityTextUrl"?t.push({_:o.entityName,url:l.href,offset:s.offset,length:e.length}):o.entityName==="messageEntityMentionName"?t.push({_:o.entityName,offset:s.offset,length:e.length,user_id:l.dataset.follow.toUserId()}):o.entityName==="messageEntityBlockquote"?t.push({_:o.entityName,pFlags:{collapsed:!!l.dataset.collapsed||void 0},offset:s.offset,length:e.length}):t.push({_:o.entityName,offset:s.offset,length:e.length})}}function H(i){const{length:e}=i;return!e||i[e-1]===v&&e===v.length}function A(i,e,t,s,n,a,o={offset:0}){if(i.nodeType===i.TEXT_NODE){let f=i.nodeValue;f=f.replace(xe,""),f?s===i?t.push(f.substr(0,n)+v+f.substr(n)):t.push(f):s===i&&t.push(v),a&&f.length&&i.parentNode&&U(i,f,a,o),o.offset+=f.length;return}if(i.nodeType!==i.ELEMENT_NODE)return;const l=()=>{e.push(t.join("")),t.length=0,++o.offset},d=s===i,u=i.matches(O.quote.match),r=Te.has(i.tagName)||u;if(r&&(t.length&&t[t.length-1].slice(-1)!==`
`||i.tagName==="BR"))l();else{const f=i.dataset.stickerEmoji||i.alt,g=i.dataset.stickerEmoji;f&&a&&U(i,f,a,o),g&&a&&a.push({_:"messageEntityCustomEmoji",document_id:i.dataset.docId,offset:o.offset,length:f.length}),f&&(t.push(f),o.offset+=f.length)}d&&!n&&t.push(v);const m=i.matches(ve),h=a?.length;let p=!0;u&&(o.isInQuote=!0);let c=i.firstChild;for(;c;)A(c,e,t,s,n,a,o),c=c.nextSibling,H(t)||(p=!1);if(u){const f=t[t.length-1];f?.endsWith(`
`)&&(t[t.length-1]=f.slice(0,-1),o.offset-=1),o.isInQuote=!1}if(p&&i.textContent?.replace(/[\r\n]/g,"")&&(p=!1),d&&n&&t.push(v),m&&i.nextSibling&&!H(t)&&(t.push(" "),++o.offset,h!==void 0))for(let f=h,g=a.length;f<g;++f)++a[f].length;r&&!p&&l(),!p&&i.tagName==="P"&&i.nextSibling&&(e.push(""),++o.offset)}function Y(i){const e=window.getSelection();let t,s;if(e?.rangeCount){const n=e.getRangeAt(0),a=n.startOffset;if(n.startContainer&&n.startContainer==n.endContainer&&a==n.endOffset){const o=a-1,l=i.childNodes;if(n.startContainer===i&&l[o]){t=l[o],s=0;for(let d=0;d<n.endOffset;++d){const u=l[d],r=u.nodeValue||u.alt;r&&(s+=r.length)}}else t=n.startContainer,s=a}}return{node:t,offset:s}}function L(i,e=!0,t=!0){const s=[],n=[],{node:a,offset:o}=!(i instanceof DocumentFragment)&&t&&Y(i),l=e?[]:void 0,d={offset:0};if(i instanceof DocumentFragment){let m=i.firstChild;for(;m;)A(m,s,n,a,o,l,d),m=m.nextSibling}else A(i,s,n,a,o,l,d);n.length&&s.push(n.join(""));let u=s.join(`
`);const r=u.indexOf(v);return r!==-1&&(u=u.substr(0,r)+u.substr(r+1)),u=u.replace(/\u00A0/g," "),l?.length&&(Se(l),z(l)),{value:u,entities:l,caretPos:r}}G.getCaretPos=Y;G.getRichValueWithCaret=L;function Le(i,e){let t;if(i.isContentEditable||i.tagName!=="INPUT"){if(i.querySelector(".emoji, .custom-emoji, .custom-emoji-placeholder"))return!1;t=i.textContent}else t=i.value;return e?!t:!t.trim()}function I(i,e,t,s){let n;if(i===t)n=e-s;else if(i.parentElement===t.parentElement)n=x(i,!0)-x(t,!0);else{const a=[];let o=i.parentElement;do a.push(o);while(o=o.parentElement);o=t.parentElement;do if(a.includes(o))break;while(o=o.parentElement);const l=o;i=w(i,l),t=w(t,l),n=x(i,!0)-x(t,!0)}return se(n,-1,1)}window.compareNodes=I;const X=new RegExp(`[^${E}]`);class R{constructor(){this.saveSelectionOnChange=e=>{const t=document.activeElement;this.saveRangeForElement(t)},this.onFocusOut=e=>{this.lastNode=this.lastOffset=void 0},this.onSelectionChange=e=>{const{input:t}=this;if(!t){this.setSelectionClassName(document.getSelection());return}let s=this.getCaretPosN();do{const{node:n,offset:a,selection:o,move:l}=s;if(n?.nodeValue!==E||!this.lastNode)break;const u=I(n,a,this.lastNode,this.lastOffset)<0;u!==void 0&&(o.isCollapsed?this.superMove(t,s,u,!0):o.modify(o.isCollapsed?"move":"extend",u?"backward":"forward","character")),this.log("selectionchange",n,a,this.lastNode,this.lastOffset,n===this.lastNode,x(this.getFiller(n)),x(this.getFiller(this.lastNode)),u,o,document.getSelection(),document.getSelection().getRangeAt(0),n?.parentNode,this.lastNode?.parentNode),s=this.getCaretPosN(),this.lastNode=n,this.lastOffset=a;break}while(!0);this.lastNode=this.lastOffset=void 0,this.setSelectionClassName(s.selection,t)},this.onBeforeInput=e=>{const{input:t,log:s}=this;if(!t)return;const n=this.addInputCallback.bind(this,t),a=this.getCaretPosN();let{node:o,offset:l,selection:d,move:u}=a;if(s("beforeinput",e,o,l,d,a),this.lastNode=this.lastOffset=void 0,e.inputType.startsWith("delete")){if(n(()=>{this.processEmptiedFillers(t),this.removeExtraBOMs(t),this.fixInsertedLineBreaks(t)}),o?.nodeValue===E&&d.isCollapsed&&e.inputType.includes("deleteContent")){const r=e.inputType.includes("Backward"),m=l===E.length&&r||!l&&!r;this.superMove(t,a,r,m)}}else if(e.inputType.startsWith("insert")){if(o?.classList?.contains("input-something")){o=o.previousSibling.firstChild;const r=d.getRangeAt(0);r.setStart(o,0),r.setEnd(o,0),r.collapse(!0);const m=this.getCaretPosN();o=m.node,d=m.selection,l=m.offset}if(o&&o.textContent===E&&l===E.length){d.modify("move","backward","character");const r=this.getCaretPosN();o=r.node,d=r.selection,l=r.offset}e.inputType;{o&&o.nodeType===o.ELEMENT_NODE&&(o=o.firstChild,s.warn("fixing focus on span"));const r=o?.nodeValue===E;if(s("inserting line break",r,o,`"${o?.nodeValue}"`,o?.parentElement?Array.from(o.parentElement.childNodes).slice():[]),r){const m=o.parentElement;m.classList.replace("input-filler","input-filler-text"),m.childNodes.length,n(()=>{m.childNodes.length>1?(s("inserting line break, remove"),o=Array.from(m.childNodes).find(p=>p.nodeValue===E),m.t=o):o.nodeValue!==E&&(s("inserting line break, deleteData"),o.deleteData(o.nodeValue.indexOf(E),E.length)),this.fixInsertedLineBreaks(t)})}else e.inputType==="insertLineBreak"&&n(()=>{this.fixInsertedLineBreaks(t)})}return}else e.inputType==="historyUndo"?n(()=>{this.processFilledFillers(t),this.processEmptiedFillers(t),this.removeExtraBOMs(t),this.removeEmptyTextNodes(t),this.fixBuggedCaret()}):e.inputType==="historyRedo"&&n(()=>{this.processFilledFillers(t),this.processEmptiedFillers(t),t.querySelectorAll(".input-something:not([contenteditable])").forEach(r=>{r.contentEditable="false"}),this.removeExtraBOMs(t),this.fixBuggedCaret()})},this.onKeyDown=e=>{const t=e.key;if(t==="ArrowDown"||t==="ArrowUp")this.lastNode=this.lastOffset=void 0;else{const{node:s,offset:n}=this.getCaretPosN();this.lastNode=s,this.lastOffset=n,this.lastNode===this.input&&(this.lastNode=this.lastOffset=void 0)}this.log("keydown",this.lastNode,this.lastNode?.parentNode,this.lastOffset,this.getCaretPosN(),e)},this.log=ne("RICH-INPUT"),this.listenerSetter=new ie,this.savedRanges=new WeakMap,this.listenerSetter.add(document)("selectionchange",this.saveSelectionOnChange)}get input(){const e=document.getSelection(),{anchorNode:t}=e;if(t)return(t.closest?t:t.parentElement).closest('[contenteditable="true"]')}saveRangeForElement(e){e&&(e.isContentEditable||e.tagName==="INPUT")&&document.getSelection().rangeCount&&this.savedRanges.set(e,document.getSelection().getRangeAt(0))}findPreviousSmthIndex(e,t,s){const n=Array.from(s??e.querySelectorAll(".input-something")),a=n.findIndex(o=>I(o,0,t,0)>=0);return a===-1?n.length-1:Math.max(0,a-1)}superMove(e,t,s,n){const{node:a,offset:o,move:l}=t,d=e.querySelectorAll(".input-something"),u=this.findPreviousSmthIndex(e,a,d),r=document.createRange();r[s?"setEnd":"setStart"](a,o),n&&l(s);const m=this.getCaretPosN();if(m.node?.nodeValue===E&&(!n||a===this.lastNode)){const h=this.findPreviousSmthIndex(e,m.node,d);let p=!n;do{const c=this.getCaretPosN(),f=this.findPreviousSmthIndex(e,c.node,d);r[s?"setStart":"setEnd"](c.node,c.offset);const g=r.toString(),N=!X.test(g);if(this.log("test cursor",g,N,h,f),N&&c.node?.nodeValue===E&&f===h&&(f||c.offset)&&(f<d.length-1||c.offset<E.length))l(s),p=!0;else if(p){(!this.getFiller(a).classList.contains("input-filler-text")&&h!==u||c.offset===E.length)&&l(!s);break}else break}while(!0)}}restoreSavedRange(e){const t=this.getSavedRange(e);if(!t)return!1;const s=window.getSelection();return s.removeAllRanges(),s.addRange(t),!0}getSavedRange(e){return this.savedRanges.get(e)}makeFocused(e){document.activeElement!==e&&!this.restoreSavedRange(e)&&Q(e,!1,!1)}fixInsertedLineBreaks(e){e.querySelectorAll("br").forEach(t=>{t.classList.add("br-not-br")})}fixBuggedCaret(){const e=document.getSelection(),t=e.getRangeAt(0);e.removeAllRanges(),e.addRange(t)}addInputCallback(e,t,s=!0){const n=()=>{this.log("input modify callback"),t()};s&&oe?this.inputCaptureCallbacks.push(n):this.listenerSetter.add(e)("input",n,{once:!0,capture:s})}removeExtraBOMs(e){const t=s=>s?.classList?.contains("input-something");e.querySelectorAll(".input-filler").forEach(s=>{const{previousSibling:n,nextSibling:a}=s;let o=!1;!a?.classList?.contains("input-filler")&&ae(a)&&(o=t(n)||t(a)),o||(this.log.warn("removing empty bom node",s),s.remove())})}getFiller(e){return e&&e.nodeType===e.TEXT_NODE&&e.parentElement!==this.input?e.parentElement:e}getCaretPosN(){const e=K(this.input);return{...e,move:this.move.bind(this,e.selection)}}removeEmptyTextNodes(e){const{log:t}=this,s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:a=>a.parentElement===e&&!a.nodeValue?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT});let n;for(;n=s.nextNode();)t.warn("removing empty text node",n),n.remove()}removePossibleBOMSiblings(e,t){[e,t].forEach(s=>{s?.classList?.contains("input-filler")&&s.remove()})}removePossibleBOMSiblingsByNode(e){const{previousSibling:t,nextSibling:s}=e;this.removePossibleBOMSiblings(t,s)}processEmptiedFillers(e){e.querySelectorAll(".input-filler-text").forEach(t=>{this.removeExtraBOMs(t);let s=!0;if(t.textContent)!X.test(t.textContent)&&!t.querySelector(".input-something")?t.classList.replace("input-filler-text","input-filler"):s=!1;else{t.classList.replace("input-filler-text","input-filler");const n=Array.from(t.childNodes).find(a=>a.nodeType===a.TEXT_NODE);n?n.insertData(0,E):t.t?.nodeValue?t.append(t.t):t.append(document.createTextNode(E))}s&&this.removePossibleBOMSiblingsByNode(t)})}processFilledFillers(e){e.querySelectorAll(".input-filler").forEach(t=>{if(t.textContent!==E){t.classList.replace("input-filler","input-filler-text");const s=t.t,n=Array.from(t.childNodes).find(a=>a.nodeType===a.TEXT_NODE&&a.nodeValue.includes(E));if(n&&!s?.nodeValue){const a=n.nodeValue.indexOf(E);a!==-1&&n.deleteData(a,E.length)}}})}setSelectionClassName(e,t){if(e.rangeCount){const s=e.getRangeAt(0);t?Array.from(t.querySelectorAll(".input-selectable")).forEach(n=>{n.classList.toggle("selection",!s.collapsed&&s.intersectsNode(n))}):Array.from(document.querySelectorAll(".input-selectable.selection")).forEach(n=>n.classList.remove("selection"))}}move(e,t){const{focusNode:s,focusOffset:n}=e;e.modify("extend",t?"backward":"forward","character"),t?e.collapseToStart():e.collapseToEnd();const{focusNode:a,focusOffset:o}=e;this.log("moving cursor",t,s,s.nodeType===s.ELEMENT_NODE?s:s.parentElement,n,a,a.nodeType===a.ELEMENT_NODE?a:a.parentElement,o)}prepareApplyingMarkdown(){const{input:e}=this,t=e.querySelectorAll(".input-filler"),s=e.querySelectorAll(".input-something");return s.forEach(n=>{n.contentEditable="inherit"}),()=>{t.forEach(n=>{n.contentEditable="inherit"}),s.forEach(n=>{n.contentEditable="false"}),this.removeExtraBOMs(e)}}static getInstance(){return this.INSTANCE??(this.INSTANCE=new R)}}function we(i){const e=document.createRange();e.selectNodeContents(i);const t=window.getSelection();t.removeAllRanges(),t.addRange(e)}const Oe=new Set(["messageEntityPre","messageEntityCode"]);function Ae(i,e){let t=-1,s=-1;return i.find(n=>{const{offset:a,length:o}=n;return Oe.has(n._)&&(t=a,s=t+o),t!==-1&&e.offset>=t&&e.offset<s&&!le.has(e._)?!0:e._===n._||!j.has(e._)&&!j.has(n._)?e.offset>=a&&e.length+e.offset<=o+a:!1})}function Ie(i,e){i=i.slice();const t=e.filter(s=>!Ae(i,s));i.push(...t),z(i);for(let s=0;s<i.length;++s){let n=i[s];if(n._==="messageEntityEmoji"){const a=i[s+1];a&&a.offset<n.offset+n.length&&(n=i[s]={...n},n.length=a.offset-n.offset)}}return i}function J(i,e={}){if(!i)return F("");let t=e.entities;return t&&!V.premium&&e.wrappingForPeerId!==V.myId&&(t=t.filter(n=>n._!=="messageEntityCustomEmoji")),F(i,{...e,entities:t,noLinks:!0,wrappingDraft:!0,passEntities:{messageEntityTextUrl:!0,messageEntityMentionName:!0}})}async function ke(i,e,t,s){const n=[],o=t?.some(h=>h._==="messageEntityCustomEmoji")?Z():void 0,l=J(e,{entities:t,wrappingForPeerId:s,loadPromises:n,customEmojiRenderer:o});l.querySelectorAll('[contenteditable="false"]').forEach(h=>{h.contentEditable="inherit",h.classList.add("pc")}),n.length&&await Promise.all(n),l.querySelectorAll(".input-selectable").forEach(h=>{h.prepend(me(!0))});const u=Array.from(l.querySelectorAll(".custom-emoji-placeholder")).map(h=>(h.dataset.ces="1",h.customEmojiElement)),r=Ee(l);o?.destroy();const m=K(i);if(!m.node){const h=document.createRange();let p=i.lastChild;p||i.append(p=document.createTextNode("")),h.setStartAfter(p),h.collapse(!0),m.selection.removeAllRanges(),m.selection.addRange(h)}i.addEventListener("input",ge,{capture:!0,once:!0,passive:!1}),window.document.execCommand("insertHTML",!1,r),Array.from(i.querySelectorAll("[data-ces]")).forEach((h,p)=>{delete h.dataset.ces;const c=u[p];h.customEmojiElement=c,c.placeholder=h}),i.querySelectorAll(".pc").forEach(h=>{h.contentEditable="false"}),$(i,"input")}let k=()=>{document.addEventListener("paste",i=>{const e=ye(i.target,'contenteditable="true"');if(!e)return;const t=!!e.dataset.noLinebreaks;i.preventDefault();let s,n,a=(i.originalEvent||i).clipboardData.getData("text/plain").replace(/\r/g,""),o=!0,l=(i.originalEvent||i).clipboardData.getData("text/html")||a;const d=r=>r._==="messageEntityEmoji"||r._==="messageEntityLinebreak"&&!t;if(t){const r=/[\r\n]/g;a=a.replace(r,""),l=l.replace(r,"")}const u=(e.dataset.peerId||he).toPeerId();if(l.trim()){l=l.replace(/<style([\s\S]*)<\/style>/,""),l=l.replace(/<!--([\s\S]*?)-->/g,""),l=l.replace('<br class="Apple-interchange-newline">',""),l=l.replace(/\r/g,"");const r=l.match(/<body>([\s\S]*)<\/body>/);r&&(l=r[1].trim());const p=new DOMParser().parseFromString(l,"text/html").body||document.createElement("body");let c=p.firstChild;for(;c;){const y=c.nextSibling;c.nodeType===c.TEXT_NODE&&(c.nodeValue.trim()||c.remove()),c=y}const f=L(p,!0,!1);!!u||(f.entities=f.entities.filter(y=>y._!=="messageEntityCustomEmoji"));{const y=f.value.split(`
`);let S=0;for(let C=0;C<y.length;++C){const _=y[C];S+=_.length;const B=S;if(a[B]!==`
`&&C!==y.length-1){const M=y.splice(C+1,1)[0];y[C]=_+M,f.entities.forEach(P=>{P.offset>=B&&(P.offset-=1)}),S+=M.length}S+=1}const T=y.join(`
`);f.value=T}const N=f.value.replace(/\s/g,"").length,b=a.replace(/\s/g,"").length;if(N===b||f.entities.find(y=>y._==="messageEntityCustomEmoji")){s=f.value,n=f.entities,o=!1;let y=q(s);y=y.filter(d),n=Ie(n,y)}}o&&(s=a,n=q(s),n=n.filter(d)),ke(e,s,n,u)}),k=null};var Re=(i=>(i[i.Neutral=0]="Neutral",i[i.Valid=1]="Valid",i[i.Error=2]="Error",i))(Re||{});function Z(i,e){return pe.create({wrappingDraft:!0,isSelectable:!0,textColor:i||"primary-text-color",animationGroup:e})}function W(i){const e=Array.from(i.querySelectorAll(".custom-emoji, .custom-emoji-placeholder"));let t=i.querySelector(".custom-emoji-renderer");if(!t&&e.length)t=Z(i.dataset.textColor,i.dataset.animationGroup),i.prepend(t);else if(t&&!e.length){t.remove();return}if(!t)return;const s=new Map;e.forEach(n=>{const a=n.loop!==void 0?n:n.customEmojiElement,{docId:o}=a;let l=s.get(o);l||s.set(o,l=new Set),l.add(a)});for(const[n,a]of s){let o=t.customEmojis.get(n);if(o)for(const l of o)a.has(l)||l.destroy();else o=new Set;for(const l of a)o.has(l)||l.connectedCallback()}t.add({addCustomEmojis:s,lazyLoadQueue:!1}),t.forceRender()}class Me{constructor(e={}){this.options=e,this.setEmpty=(g=this.isEmpty())=>{[this.input,this.placeholder].filter(Boolean).forEach(N=>{N.classList.toggle("is-empty",g)})},this.container=document.createElement("div"),this.container.classList.add("input-field"),this.required=e.required,this.validate=e.validate,e.maxLength!==void 0&&e.showLengthOn===void 0&&(e.showLengthOn=Math.min(40,Math.round(e.maxLength/3)));const{placeholder:t,maxLength:s,showLengthOn:n,name:a,plainText:o,canBeEdited:l=!0,autocomplete:d,withBorder:u,allowStartingSpace:r,canHaveFormatting:m}=e,h=e.label||e.labelText;this.allowStartingSpace=r;const p=[];let c;if(o?(this.container.innerHTML=`
      <input type="text" ${a?`name="${a}"`:""} autocomplete="${d??"off"}" ${h?'required=""':""} class="input-field-input">
      `,c=this.container.firstElementChild,p.push(()=>{const g=this.isEmpty();g&&(c.value=""),this.setEmpty(g)})):(k&&k(),this.container.innerHTML='<div class="input-field-input"></div>',c=this.container.firstElementChild,c.contentEditable=""+!!l,R.getInstance(),c.addEventListener("mousedown",g=>{const N=document.getSelection();if(!N.isCollapsed)return;const b=Ne(g.target,"IMG");if(!b)return;const y=b.getBoundingClientRect(),S=y.left+y.width/2,T=g.clientX>=S,C=document.createRange();C.setStartAfter(T?b:b.previousSibling??b),N.removeAllRanges(),N.addRange(C)}),m&&c.setAttribute("can-format",m.join(",")),p.push(()=>{const g=this.isEmpty();g&&c.replaceChildren(),this.setEmpty(g),ue(Array.from(c.querySelectorAll(".input-something"))),W(c)})),re(c),e.inputMode&&(c.inputMode=e.inputMode),t&&(this.placeholder=document.createElement("span"),this.placeholder.classList.add("input-field-placeholder"),this.container.append(this.placeholder),ce(this.placeholder,t,void 0)),u!==!1&&u||h||t){const g=document.createElement("div");g.classList.add("input-field-border"),this.container.append(g)}if(h&&(this.label=document.createElement("label"),this.setLabel(),this.container.append(this.label)),s){const g=this.container.lastElementChild;let N=!1;const b=()=>{const y=c.classList.contains("error"),S=o?c.value.length:[...L(c,!1,!1).value].length,T=s-S,C=T<0;c.classList.toggle("error",C),C||T<=n?(this.setLabel(),g.append(` (${s-S})`),N||(N=!0)):(y&&!C||N)&&(this.setLabel(),N=!1)};p.push(b)}!e.withLinebreaks&&!o&&(c.dataset.noLinebreaks="1",c.addEventListener("keypress",g=>{if(g.key==="Enter")return g.preventDefault(),!1})),e.onRawInput&&p.push(()=>{e.onRawInput(this.value)}),p.length&&c.addEventListener("input",()=>{p.forEach(g=>g())}),this.input=c,this.setEmpty(!0)}select(){this.value&&(this.options.plainText?this.input.select():we(this.input))}setLabel(){this.label.textContent="",this.options.labelText?fe(this.label,this.options.labelText):this.label.append(D(this.options.label,this.options.labelOptions))}get value(){return this.options.plainText?this.input.value:L(this.input,!1,!1).value}set value(e){this.setValueSilently(e,!0),this.simulateInputEvent()}simulateInputEvent(){$(this.input,"input")}setValueSilently(e,t){this.options.plainText?this.input.value=e:(de(this.input,e),W(this.input)),this.setEmpty()}isEmpty(){return Le(this.input,this.allowStartingSpace)}isChanged(){return this.value!==this.originalValue}isValid(){return!this.input.classList.contains("error")&&(!this.validate||this.validate())&&(!this.required||!this.isEmpty())}isValidToChange(){return this.isValid()&&this.isChanged()}setDraftValue(e="",t){let s=e;this.options.plainText||(s=J(e)),t?this.setValueSilently(s,!1):this.value=s}setOriginalValue(e="",t){this.originalValue=e,this.setDraftValue(e,t)}setState(e,t){t?(this.label.textContent="",this.label.append(D(t,this.options.labelOptions))):this.setLabel(),this.input.classList.toggle("error",!!(e&2)),this.input.classList.toggle("valid",!!(e&1))}setError(e){this.setState(2,e)}}export{Me as I,R,Re as a,Ne as b,L as c,Ee as d,Se as e,ye as f,Ce as g,Ae as h,Le as i,O as j,ke as k,Ie as m,Q as p,z as s,J as w};
//# sourceMappingURL=inputField-DFBRs3wP.js.map
